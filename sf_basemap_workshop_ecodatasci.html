<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rachel King">
<meta name="dcterms.date" content="2024-03-05">

<title>Spatial Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="sf_basemap_workshop_ecodatasci_files/libs/clipboard/clipboard.min.js"></script>
<script src="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/quarto.js"></script>
<script src="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/popper.min.js"></script>
<script src="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/anchor.min.js"></script>
<link href="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="sf_basemap_workshop_ecodatasci_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="sf_basemap_workshop_ecodatasci_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="sf_basemap_workshop_ecodatasci_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="sf_basemap_workshop_ecodatasci_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sections</h2>
   
  <ul>
  <li><a href="#helpful-background" id="toc-helpful-background" class="nav-link active" data-scroll-target="#helpful-background">Helpful Background</a></li>
  <li><a href="#goals-and-learning-outcomes" id="toc-goals-and-learning-outcomes" class="nav-link" data-scroll-target="#goals-and-learning-outcomes">Goals and Learning Outcomes</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up</a>
  <ul class="collapse">
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link" data-scroll-target="#loading-packages">Loading Packages</a></li>
  </ul></li>
  <li><a href="#part-i-intro-to-working-with-spatial-data-with-the-sf-package" id="toc-part-i-intro-to-working-with-spatial-data-with-the-sf-package" class="nav-link" data-scroll-target="#part-i-intro-to-working-with-spatial-data-with-the-sf-package">Part I: Intro to working with spatial data with the <strong><code>sf</code></strong> package</a>
  <ul class="collapse">
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a>
  <ul class="collapse">
  <li><a href="#about-the-data" id="toc-about-the-data" class="nav-link" data-scroll-target="#about-the-data">About the Data</a></li>
  <li><a href="#method-1-from-a-.csv-file" id="toc-method-1-from-a-.csv-file" class="nav-link" data-scroll-target="#method-1-from-a-.csv-file">Method 1: From a <code>.csv</code> file</a></li>
  <li><a href="#method-2-from-a-shapefile" id="toc-method-2-from-a-shapefile" class="nav-link" data-scroll-target="#method-2-from-a-shapefile">Method 2: From a shapefile</a></li>
  <li><a href="#method-3-from-a-package" id="toc-method-3-from-a-package" class="nav-link" data-scroll-target="#method-3-from-a-package">Method 3: From a package</a></li>
  </ul></li>
  <li><a href="#working-with-sf-data" id="toc-working-with-sf-data" class="nav-link" data-scroll-target="#working-with-sf-data">Working with <code>sf</code> data</a>
  <ul class="collapse">
  <li><a href="#basics-of-sf-data-types" id="toc-basics-of-sf-data-types" class="nav-link" data-scroll-target="#basics-of-sf-data-types">Basics of <code>sf</code> data types</a></li>
  <li><a href="#identify-and-set-the-crs" id="toc-identify-and-set-the-crs" class="nav-link" data-scroll-target="#identify-and-set-the-crs">Identify and set the CRS</a></li>
  <li><a href="#basic-spatial-data-operations" id="toc-basic-spatial-data-operations" class="nav-link" data-scroll-target="#basic-spatial-data-operations">Basic Spatial Data Operations</a></li>
  </ul></li>
  <li><a href="#making-the-map" id="toc-making-the-map" class="nav-link" data-scroll-target="#making-the-map">Making the map</a></li>
  </ul></li>
  <li><a href="#part-ii-add-a-basemap" id="toc-part-ii-add-a-basemap" class="nav-link" data-scroll-target="#part-ii-add-a-basemap">Part II: Add a Basemap</a>
  <ul class="collapse">
  <li><a href="#my-favorite-basemap-providers-packages-and-functions" id="toc-my-favorite-basemap-providers-packages-and-functions" class="nav-link" data-scroll-target="#my-favorite-basemap-providers-packages-and-functions">My Favorite Basemap Providers, Packages and Functions</a></li>
  <li><a href="#retrieving-your-basemap" id="toc-retrieving-your-basemap" class="nav-link" data-scroll-target="#retrieving-your-basemap">Retrieving your basemap</a>
  <ul class="collapse">
  <li><a href="#using-ggspatial" id="toc-using-ggspatial" class="nav-link" data-scroll-target="#using-ggspatial">Using <code>ggspatial</code></a></li>
  <li><a href="#using-maptiles" id="toc-using-maptiles" class="nav-link" data-scroll-target="#using-maptiles">Using <code>maptiles</code></a></li>
  <li><a href="#additional-basemap-options" id="toc-additional-basemap-options" class="nav-link" data-scroll-target="#additional-basemap-options">Additional basemap options</a></li>
  <li><a href="#basemap-from-file" id="toc-basemap-from-file" class="nav-link" data-scroll-target="#basemap-from-file">Basemap from File</a></li>
  </ul></li>
  <li><a href="#add-a-scalebar-and-north-arrow" id="toc-add-a-scalebar-and-north-arrow" class="nav-link" data-scroll-target="#add-a-scalebar-and-north-arrow">Add a scalebar and north arrow</a>
  <ul class="collapse">
  <li><a href="#manipulating-scale-and-north-arrow" id="toc-manipulating-scale-and-north-arrow" class="nav-link" data-scroll-target="#manipulating-scale-and-north-arrow">Manipulating scale and north arrow</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#part-iii-tips-and-tricks" id="toc-part-iii-tips-and-tricks" class="nav-link" data-scroll-target="#part-iii-tips-and-tricks">Part III: Tips and Tricks</a>
  <ul class="collapse">
  <li><a href="#making-an-inset-map" id="toc-making-an-inset-map" class="nav-link" data-scroll-target="#making-an-inset-map">Making an inset map</a></li>
  <li><a href="#creating-a-theme-and-setting-defaults" id="toc-creating-a-theme-and-setting-defaults" class="nav-link" data-scroll-target="#creating-a-theme-and-setting-defaults">Creating a Theme and Setting Defaults</a>
  <ul class="collapse">
  <li><a href="#create-your-own-theme" id="toc-create-your-own-theme" class="nav-link" data-scroll-target="#create-your-own-theme">Create your own theme</a></li>
  <li><a href="#set-geometry-defaults" id="toc-set-geometry-defaults" class="nav-link" data-scroll-target="#set-geometry-defaults">Set Geometry Defaults</a></li>
  </ul></li>
  <li><a href="#functional-programming" id="toc-functional-programming" class="nav-link" data-scroll-target="#functional-programming">Functional Programming</a></li>
  </ul></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Spatial Data Visualization</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rachel King </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 5, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="helpful-background" class="level1">
<h1>Helpful Background</h1>
<p>This workshop will be most helpful if you have spent some time working with data in R, either for data analysis or visualization. Specifically, the workshop will be most helpful if you are:</p>
<ul>
<li><p>comfortable with the basics of working with data in R (reading in data, tidyverse functions, making a graph with ggplot)</p></li>
<li><p>familiar with different types of spatial data (not necessarily working with them in R)</p></li>
<li><p>have an interest in spatial data and learning how R can help you with spatial data visualization</p></li>
</ul>
<p>The primary purpose is to demonstrate how to use R to visualize spatial data, rather than give a full tutorial on the basics of geospatial data though we will review some basic concepts quickly. Therefore we may not cover some important concepts that are important for spatial data analysis, For more in-depth learning I recommend reading “Geocomputation with R” by Lovelace et al.&nbsp;(2024), a free ebook available here: https://r.geocompx.org/.</p>
</section>
<section id="goals-and-learning-outcomes" class="level1">
<h1>Goals and Learning Outcomes</h1>
<p>By the end of the session you should be able to:</p>
<ol type="1">
<li><p>Read in and map simple spatial data</p></li>
<li><p>Add a basemap, scalebar and north arrow to your maps</p></li>
<li><p>Understand how you can use R to streamline the map-making process (using themes and functions)</p></li>
</ol>
</section>
<section id="set-up" class="level1">
<h1>Set Up</h1>
<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">Loading Packages</h2>
<p>First we need to load packages and data for our mapping. Note that some of these packages will only work if you have already installed GDAL (Geospatial Data Abstraction Library) - a “computer software library for reading and writing raster and vector geospatial data formats”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General Packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># data manipulation and plotting </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)   <span class="co"># plotting and mapping</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combining maps/plots</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial Packages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)        <span class="co"># manipulating spatial data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial) <span class="co"># retrieving basemap, adding scale and arrowbar</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maptiles)  <span class="co"># retrieving basemap</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)     <span class="co"># working with raster data</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyterra) <span class="co"># functions for working with raster</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Data </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)  <span class="co"># shapefiles with various administrative boundaries and roads</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another good option for plotting spatial data in R is the <code>tmap</code> package with companion package <code>tmaptools</code>. However, the syntax is slightly different so I won’t cover that today. It does allow an interactive view feature via Leaflet which is nice, and maybe the subject for a future EcoDataScience workshop.</p>
</section>
</section>
<section id="part-i-intro-to-working-with-spatial-data-with-the-sf-package" class="level1">
<h1>Part I: Intro to working with spatial data with the <strong><code>sf</code></strong> package</h1>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<section id="about-the-data" class="level3">
<h3 class="anchored" data-anchor-id="about-the-data">About the Data</h3>
<p>The data used here are open source data available either on the KNB data repository or from the US Government. The specific data sources and citations are listed below:</p>
<table class="table">
<thead>
<tr class="header">
<th>Data</th>
<th>Original Dataset</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Study Sites</td>
<td>cj lortie, M Zuliani, Nargol Ghazian, Jenna Braun, S Haas, &amp; Rachel King. 2022. A list of ecological study sites within Central California Drylands. Knowledge Network for Biocomplexity. <a href="https://doi.org/10.5063/F1F76B1R">doi:10.5063/F1F76B1R</a>.</td>
</tr>
<tr class="even">
<td>California Ecoregions</td>
<td>U.S. Environmental Protection Agency. 2012. Level IV Ecoregions of California. U.S. EPA Office of Research and Development (ORD) - National Health and Environmental Effects Research Laboratory (NHEERL), Corvallis, OR. <a href="https://www.epa.gov/eco-research/ecoregion-download-files-state-region-9#pane-04">California Level IV Ecoregions</a></td>
</tr>
<tr class="odd">
<td>California State Boundary</td>
<td>U.S. Census Bureau TIGER/Line Shapefiles. (2023). <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/tiger-line-file.html"></a></td>
</tr>
</tbody>
</table>
</section>
<section id="method-1-from-a-.csv-file" class="level3">
<h3 class="anchored" data-anchor-id="method-1-from-a-.csv-file">Method 1: From a <code>.csv</code> file</h3>
<p>We will download the site data from KNB to show how to read in data from a <code>.csv</code> file and prepare it for mapping. When you use a <code>.csv</code> you will have to convert it to an <code>sf</code> object to use the <code>sf</code> package functions for easier plotting, which I will show in a moment.</p>
<p>Download site data from: <a href="https://doi.org/10.5063/F1F76B1R">California Dryland Sites</a></p>
<p>https://doi.org/10.5063/F1F76B1R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data from .csv file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>site_df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://knb.ecoinformatics.org/knb/d1/mn/v2/object/urn%3Auuid%3A5d23a3f4-6ed8-47f0-b34e-000f6cfb8313"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 51 Columns: 19
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (10): state, desert, region, experiment, site_acronym, site_code, founda...
dbl  (9): elevation, area_m2, area_block_m2, MAT, MAP, long, lat, aridity, n...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># alternatively download into your working directory and run </span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># site_df &lt;- read_csv("tidy_regional_2023.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="method-2-from-a-shapefile" class="level3">
<h3 class="anchored" data-anchor-id="method-2-from-a-shapefile">Method 2: From a shapefile</h3>
<p>The second data layer we will read in is a shapefile with ecoregions for California that is provided by the US EPA: <a href="https://www.epa.gov/eco-research/ecoregion-download-files-state-region-9#pane-04">California Level IV Ecoregions</a></p>
<p>You’ll need to download and unzip the data file into your working directory for the following code to work.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>When reading in a shapefile, you use the filename with the <code>.shp</code> extension, but the associated files from the zipped folder are required for the data to read in properly. So, if you only unzip and then only copy the <code>.shp</code> file into your working directory or data folder for a project you will get an error message.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data from shapefile</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ecoreg_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="st">"data/ca_ecoregion_shape/ca_eco_l4.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="method-3-from-a-package" class="level3">
<h3 class="anchored" data-anchor-id="method-3-from-a-package">Method 3: From a package</h3>
<p>The <code>tigris</code> package allows you to easily download TIGER/Line shapefiles from the US Census Bureau for things like state boundaries, roads, county lines, etc. The <code>tidycensus</code> package that was in a previous EcoDataScience Workshop uses this package when getting spatial data.</p>
<p>We’ll use it to download some boundaries for the state of California.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in data using package </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>states_sf <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">states</span>(<span class="at">progress_bar =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>CA_counties_sf <span class="ot">&lt;-</span> tigris<span class="sc">::</span><span class="fu">counties</span>(<span class="at">state =</span> <span class="st">"CA"</span>, <span class="at">progress_bar =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="working-with-sf-data" class="level2">
<h2 class="anchored" data-anchor-id="working-with-sf-data">Working with <code>sf</code> data</h2>
<p>Now we’ll see some useful features of the <code>sf</code> package and how to access and set important spatial information from your data.</p>
<section id="basics-of-sf-data-types" class="level3">
<h3 class="anchored" data-anchor-id="basics-of-sf-data-types">Basics of <code>sf</code> data types</h3>
<p>talk about “attribute tables”</p>
</section>
<section id="identify-and-set-the-crs" class="level3">
<h3 class="anchored" data-anchor-id="identify-and-set-the-crs">Identify and set the CRS</h3>
<p>Essential that the CRS of your spatial data match</p>
<p>When you read in data from a shapefile or a package the data will usually already have the CRS information associated with the data.</p>
<p>When you are reading in data from a <code>.csv</code> file, you need to set the CRS yourself when you convert your <code>data.frame</code> into an <code>sf</code> object. Thus, you’ll need to check the metadata to find the appropriate CRS.</p>
<p>You’ll often see lat/long data use the WGS84 CRS, which is a geographic coordinate reference system.</p>
<p>An easy way to specify this is to use the <strong>EPSG</strong> code (European Petroleum Survey Group), which references a database of the associated geodetic parameters for common CRS. The code for the WGS84 is <strong>EPSG:4326</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(site_df) <span class="co"># check column names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "state"         "desert"        "region"        "experiment"   
 [5] "site_acronym"  "site_code"     "foundation"    "elevation"    
 [9] "aspect"        "area_m2"       "area_calc"     "polygon_block"
[13] "area_block_m2" "MAT"           "MAP"           "long"         
[17] "lat"           "aridity"       "ndvi_2023"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The coordinate information is in the "long" and "lat column</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>site_sf <span class="ot">&lt;-</span> site_df <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="co"># specify where spatial data is; "longitude" is first</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs    =</span> <span class="st">"EPSG:4326"</span>      <span class="co"># need to tell it what the CRS is</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you’ll see that our site data not just a data frame but is also now an <code>sf</code> object, which allows us to use all of the <code>sf</code> functions with this data now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(site_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "sf"         "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(site_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 17 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -120.1018 ymin: 34.87623 xmax: -114.9 ymax: 36.06219
Geodetic CRS:  WGS 84
# A tibble: 6 × 18
  state     desert region experiment site_acronym site_code foundation elevation
  &lt;chr&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt;
1 Californ… Mojave Mojave invasion   Antelope_va… Antelope… Ephedra c…       NA 
2 Californ… San J… San J… BNLL diet  Avenal - hw… Avenal    Ephedra c…       NA 
3 Californ… Mojave Mojave ERG        Barstow      Barstow_1 Ephedra c…      496.
4 Californ… Mojave Mojave invasion   Barstow_2    Barstow_2 Ephedra c…       NA 
5 Nevada    Mojave Mojave invasion   Cal-Nev-Ari  Cal_nev_… Larrea tr…       NA 
6 Californ… San J… Carri… BNLL       plant-animal Carrizo_1 Ephedra c…       NA 
# ℹ 10 more variables: aspect &lt;chr&gt;, area_m2 &lt;dbl&gt;, area_calc &lt;chr&gt;,
#   polygon_block &lt;chr&gt;, area_block_m2 &lt;dbl&gt;, MAT &lt;dbl&gt;, MAP &lt;dbl&gt;,
#   aridity &lt;dbl&gt;, ndvi_2023 &lt;dbl&gt;, geometry &lt;POINT [°]&gt;</code></pre>
</div>
</div>
<p>You’ll also see that we have some new attribute information associated with this object:</p>
<ul>
<li><p>Geometry Type: Point</p></li>
<li><p>Dimension</p></li>
<li><p>Bounding Box</p></li>
<li><p>CRS</p></li>
</ul>
<p>We can also access this info with some common <code>sf</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the crs</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(site_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: EPSG:4326 
  wkt:
GEOGCRS["WGS 84",
    ENSEMBLE["World Geodetic System 1984 ensemble",
        MEMBER["World Geodetic System 1984 (Transit)"],
        MEMBER["World Geodetic System 1984 (G730)"],
        MEMBER["World Geodetic System 1984 (G873)"],
        MEMBER["World Geodetic System 1984 (G1150)"],
        MEMBER["World Geodetic System 1984 (G1674)"],
        MEMBER["World Geodetic System 1984 (G1762)"],
        MEMBER["World Geodetic System 1984 (G2139)"],
        ELLIPSOID["WGS 84",6378137,298.257223563,
            LENGTHUNIT["metre",1]],
        ENSEMBLEACCURACY[2.0]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["geodetic latitude (Lat)",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["geodetic longitude (Lon)",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    USAGE[
        SCOPE["Horizontal component of 3D system."],
        AREA["World."],
        BBOX[-90,-180,90,180]],
    ID["EPSG",4326]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># retrieve the bounding box around all points in the object</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_bbox</span>(site_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      xmin       ymin       xmax       ymax 
-120.81229   34.20568 -114.07000   36.76000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_geometry_type</span>(site_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT
[13] POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT
[25] POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT
[37] POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT POINT
[49] POINT POINT POINT
18 Levels: GEOMETRY POINT LINESTRING POLYGON MULTIPOINT ... TRIANGLE</code></pre>
</div>
</div>
<p>Now we need to check the CRS for the other datasets to see if they match:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crs for ecoregions</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(ecoreg_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: USA_Contiguous_Albers_Equal_Area_Conic_USGS_version 
  wkt:
PROJCRS["USA_Contiguous_Albers_Equal_Area_Conic_USGS_version",
    BASEGEOGCRS["NAD83",
        DATUM["North American Datum 1983",
            ELLIPSOID["GRS 1980",6378137,298.257222101,
                LENGTHUNIT["metre",1]]],
        PRIMEM["Greenwich",0,
            ANGLEUNIT["Degree",0.0174532925199433]]],
    CONVERSION["USA_Contiguous_Albers_Equal_Area_Conic_USGS_version",
        METHOD["Albers Equal Area",
            ID["EPSG",9822]],
        PARAMETER["Latitude of false origin",23,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8821]],
        PARAMETER["Longitude of false origin",-96,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8822]],
        PARAMETER["Latitude of 1st standard parallel",29.5,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8823]],
        PARAMETER["Latitude of 2nd standard parallel",45.5,
            ANGLEUNIT["Degree",0.0174532925199433],
            ID["EPSG",8824]],
        PARAMETER["Easting at false origin",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8826]],
        PARAMETER["Northing at false origin",0,
            LENGTHUNIT["metre",1],
            ID["EPSG",8827]]],
    CS[Cartesian,2],
        AXIS["(E)",east,
            ORDER[1],
            LENGTHUNIT["metre",1]],
        AXIS["(N)",north,
            ORDER[2],
            LENGTHUNIT["metre",1]],
    USAGE[
        SCOPE["Not known."],
        AREA["United States (USA) - CONUS onshore - Alabama; Arizona; Arkansas; California; Colorado; Connecticut; Delaware; Florida; Georgia; Idaho; Illinois; Indiana; Iowa; Kansas; Kentucky; Louisiana; Maine; Maryland; Massachusetts; Michigan; Minnesota; Mississippi; Missouri; Montana; Nebraska; Nevada; New Hampshire; New Jersey; New Mexico; New York; North Carolina; North Dakota; Ohio; Oklahoma; Oregon; Pennsylvania; Rhode Island; South Carolina; South Dakota; Tennessee; Texas; Utah; Vermont; Virginia; Washington; West Virginia; Wisconsin; Wyoming."],
        BBOX[24.41,-124.79,49.38,-66.91]],
    ID["ESRI",102039]]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(states_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coordinate Reference System:
  User input: NAD83 
  wkt:
GEOGCRS["NAD83",
    DATUM["North American Datum 1983",
        ELLIPSOID["GRS 1980",6378137,298.257222101,
            LENGTHUNIT["metre",1]]],
    PRIMEM["Greenwich",0,
        ANGLEUNIT["degree",0.0174532925199433]],
    CS[ellipsoidal,2],
        AXIS["latitude",north,
            ORDER[1],
            ANGLEUNIT["degree",0.0174532925199433]],
        AXIS["longitude",east,
            ORDER[2],
            ANGLEUNIT["degree",0.0174532925199433]],
    ID["EPSG",4269]]</code></pre>
</div>
</div>
<p>So, all of our spatial data sets currently have different CRS. We will need to reproject the data from two of the three so that we will be able to map all our data at the same time.</p>
</section>
<section id="basic-spatial-data-operations" class="level3">
<h3 class="anchored" data-anchor-id="basic-spatial-data-operations">Basic Spatial Data Operations</h3>
<p>We can use the <code>st_transform</code> function to project our data into the same CRS.</p>
<p>But which CRS should we choose for our map making? It depends on what you are doing… The site data and state data are in geographic CRS (not projected) while the ecoregion data are in the USA Contiguous Albers Equal Area Conic USGS version projected CRS. If we’re making a map for a web-based application, those often use geographic CRS like WGS84 (googlemaps, openstreetmap) but for a static map it may make sense to use a projection more specific to your area or goal (e.g.&nbsp;equal area). For simplicity, today I’ll transform the state and site data to the CRS of the ecoregion data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># project site and state lines to ecoreg CRS</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>states_proj_sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(states_sf, <span class="fu">st_crs</span>(ecoreg_sf))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>site_proj_sf   <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(site_sf, <span class="fu">st_crs</span>(ecoreg_sf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The states dataset also contains data for ALL US states. We can filter this data just like any other dataset so we just have the outline for California:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>ca_proj_sf <span class="ot">&lt;-</span> states_proj_sf <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"California"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are some sites that are outside the state of California, and I only want to map the California locations. We can use the state outline to filter our site data to just include the sites within our area of interest:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(site_proj_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sf [51 × 18] (S3: sf/tbl_df/tbl/data.frame)
 $ state        : chr [1:51] "California" "California" "California" "California" ...
 $ desert       : chr [1:51] "Mojave" "San Joaquin" "Mojave" "Mojave" ...
 $ region       : chr [1:51] "Mojave" "San Joaquin" "Mojave" "Mojave" ...
 $ experiment   : chr [1:51] "invasion" "BNLL diet" "ERG" "invasion" ...
 $ site_acronym : chr [1:51] "Antelope_valley" "Avenal - hwy 269" "Barstow" "Barstow_2" ...
 $ site_code    : chr [1:51] "Antelope_valley" "Avenal" "Barstow_1" "Barstow_2" ...
 $ foundation   : chr [1:51] "Ephedra californica" "Ephedra californica" "Ephedra californica" "Ephedra californica" ...
 $ elevation    : num [1:51] NA NA 496 NA NA ...
 $ aspect       : chr [1:51] NA NA NA NA ...
 $ area_m2      : num [1:51] 105095 139838 114251 7542 4536 ...
 $ area_calc    : chr [1:51] "polygon" "polygon" "polygon" "polygon" ...
 $ polygon_block: chr [1:51] "Mojave west" "none" "Mojave west" "none" ...
 $ area_block_m2: num [1:51] 6.03e+08 2.00e+08 6.03e+08 NA NA ...
 $ MAT          : num [1:51] 13.1 17.3 19 16.6 18.2 ...
 $ MAP          : num [1:51] 123 169 160 160 129 152 152 150 146 147 ...
 $ aridity      : num [1:51] 5.32 6.19 5.52 6.02 4.57 ...
 $ ndvi_2023    : num [1:51] 0.275 0.632 0.109 0.238 0.153 ...
 $ geometry     :sfc_POINT of length 51; first list element:  'XY' num [1:2] -2029902 1555487
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
  ..- attr(*, "names")= chr [1:17] "state" "desert" "region" "experiment" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(site_proj_sf<span class="sc">$</span>state) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "California" "Nevada"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>site_ca_proj_sf <span class="ot">&lt;-</span> site_proj_sf <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_filter</span>(ca_proj_sf, <span class="at">.predicate =</span> st_covered_by)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(site_ca_proj_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sf [48 × 18] (S3: sf/tbl_df/tbl/data.frame)
 $ state        : chr [1:48] "California" "California" "California" "California" ...
 $ desert       : chr [1:48] "Mojave" "San Joaquin" "Mojave" "Mojave" ...
 $ region       : chr [1:48] "Mojave" "San Joaquin" "Mojave" "Mojave" ...
 $ experiment   : chr [1:48] "invasion" "BNLL diet" "ERG" "invasion" ...
 $ site_acronym : chr [1:48] "Antelope_valley" "Avenal - hwy 269" "Barstow" "Barstow_2" ...
 $ site_code    : chr [1:48] "Antelope_valley" "Avenal" "Barstow_1" "Barstow_2" ...
 $ foundation   : chr [1:48] "Ephedra californica" "Ephedra californica" "Ephedra californica" "Ephedra californica" ...
 $ elevation    : num [1:48] NA NA 496 NA NA ...
 $ aspect       : chr [1:48] NA NA NA NA ...
 $ area_m2      : num [1:48] 105095 139838 114251 7542 284424 ...
 $ area_calc    : chr [1:48] "polygon" "polygon" "polygon" "polygon" ...
 $ polygon_block: chr [1:48] "Mojave west" "none" "Mojave west" "none" ...
 $ area_block_m2: num [1:48] 6.03e+08 2.00e+08 6.03e+08 NA 2.00e+08 ...
 $ MAT          : num [1:48] 13.1 17.3 19 16.6 14.7 ...
 $ MAP          : num [1:48] 123 169 160 160 152 152 150 146 147 154 ...
 $ aridity      : num [1:48] 5.32 6.19 5.52 6.02 6.15 ...
 $ ndvi_2023    : num [1:48] 0.275 0.632 0.109 0.238 0.574 ...
 $ geometry     :sfc_POINT of length 48; first list element:  'XY' num [1:2] -2029902 1555487
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA NA NA NA NA ...
  ..- attr(*, "names")= chr [1:17] "state" "desert" "region" "experiment" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(site_ca_proj_sf<span class="sc">$</span>state)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "California"</code></pre>
</div>
</div>
<p>Here we used the <code>st_filter</code> function which can take a user-specified predicate function to “keep the geometries in x where .predicate(x,y) returns any match in y for x”. So, <code>st_covered_by</code> will return all values in x (<code>site_proj_sf</code>) that are covered by y (<code>ca_proj_sf</code>).</p>
<p>Now, if I wanted to know the ecoregion of each of my sites I could also find that out using a spatial join. Using <code>st_join</code> we will add in the attributes of the <code>ecoreg_sf</code> object at any location that intersects the coordinates from the <code>site_ca_proj_sf</code> object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>site_ecoreg_sf <span class="ot">&lt;-</span> <span class="fu">st_join</span>(site_ca_proj_sf, ecoreg_sf, <span class="at">join =</span> st_intersects)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># st_intersects is the default</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(site_ecoreg_sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "state"         "desert"        "region"        "experiment"   
 [5] "site_acronym"  "site_code"     "foundation"    "elevation"    
 [9] "aspect"        "area_m2"       "area_calc"     "polygon_block"
[13] "area_block_m2" "MAT"           "MAP"           "aridity"      
[17] "ndvi_2023"     "geometry"      "OBJECTID"      "US_L4CODE"    
[21] "US_L4NAME"     "US_L3CODE"     "US_L3NAME"     "NA_L3CODE"    
[25] "NA_L3NAME"     "NA_L2CODE"     "NA_L2NAME"     "NA_L1CODE"    
[29] "NA_L1NAME"     "STATE_NAME"    "EPA_REGION"    "L4_KEY"       
[33] "L3_KEY"        "L2_KEY"        "L1_KEY"        "Shape_Leng"   
[37] "Shape_Area"   </code></pre>
</div>
</div>
</section>
</section>
<section id="making-the-map" class="level2">
<h2 class="anchored" data-anchor-id="making-the-map">Making the map</h2>
<p>Finally it’s time to make our map! One of the simplest ways to do this is to use <code>ggplot2</code> which works well with <code>sf</code> objects.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co">#TODO build this map out slowly, one element at a time</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># must specify "data = " or it will throw an error</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ecoreg_sf, <span class="fu">aes</span>(<span class="at">fill =</span> US_L3NAME)) <span class="sc">+</span> <span class="co"># like other data you can set fill </span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ca_proj_sf) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"US L3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You can also use <code>facet_wrap()</code> to split your map into smaller maps with any of your variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># must specify "data = " or it will throw an error</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ecoreg_sf, <span class="fu">aes</span>(<span class="at">fill =</span> US_L3NAME)) <span class="sc">+</span> <span class="co"># like other data you can set fill </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ca_proj_sf) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">"US L3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>desert)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Unfortunately, when using <code>geom_sf</code> the <code>scales = "free"</code> option doesn’t work with faceting, so if you want to create a map with something that looks like facets it is probably easier to create two separate maps and combine them using either the <code>patchwork</code> or <code>cowplot</code> package.</p>
</section>
</section>
<section id="part-ii-add-a-basemap" class="level1">
<h1>Part II: Add a Basemap</h1>
<p>Basemaps provide important geographical context for your data and can serve as an important visual references for your maps. In GIS programs it is often pretty easy to add a basemap layer, but in R there are a few additional steps and are produced by various sources</p>
<section id="my-favorite-basemap-providers-packages-and-functions" class="level2">
<h2 class="anchored" data-anchor-id="my-favorite-basemap-providers-packages-and-functions">My Favorite Basemap Providers, Packages and Functions</h2>
<p>There are many options for basemaps for your mapping projects in R, as well as several different packages for working with those map layers. Basemaps are provided as a series of tiles from various basemap providers, some are freely available and others require registration and/or a subscription to access them via an API key. Below I list the providers of various basemaps</p>
<p><strong>Basemap Data Providers</strong>:</p>
<p>*: requires registration but has a free tier **: paid service</p>
<ul>
<li><p>OpenStreetMap</p></li>
<li><p>Stamen via Stadia*</p></li>
<li><p>Thunderforest*</p></li>
<li><p>Carto**</p></li>
<li><p><a href="https://www.mapbox.com/static-maps">Mapbox</a>*</p></li>
<li><p>Google</p></li>
</ul>
<p><strong>Basemap R Packages</strong></p>
<p>Make it “easy” to download and bring in the basemap tiles to R. In reality, I have found that some packages are much easier than others to work with.</p>
<p>My favorites:</p>
<ul>
<li><p><a href="https://paleolimbot.github.io/ggspatial/index.html"><code>ggspatial</code></a></p>
<ul>
<li><p>uses <code>rosm::osm.image()</code> to display/fetch map tiles</p></li>
<li><p>easy integration with ggplot (returns a ggplot layer)</p></li>
<li><p>can’t directly specify spatial extent, uses your data</p></li>
</ul></li>
<li><p><a href="https://github.com/riatelab/maptiles"><code>maptiles</code></a></p>
<ul>
<li><p>pretty easy to download</p></li>
<li><p>doesn’t</p></li>
</ul></li>
</ul>
<p><strong>Other Packages to Examine</strong></p>
<ul>
<li><p><a href="https://github.com/dkahle/ggmap"><code>ggmap</code></a>: requires google maps API key to use, even if tile provider doesn’t require one; visualizes with <code>ggplot</code>; good for getting Google Maps</p></li>
<li><p><a href="https://walker-data.com/mapboxapi/"><code>mapboxapi</code></a>: requires Mapbox account (there is a free tier)</p></li>
<li><p><a href="https://github.com/ifellows/ROSM"><code>OpenStreetMap</code></a>: requires Java installation</p></li>
<li><p><a href="https://github.com/paleolimbot/rosm"><code>rosm</code></a>: not designed to work with <code>ggplot</code>, uses <code>prettymapr</code></p></li>
<li><p><a href="https://github.com/Chrisjb/basemapR"><code>basemapR</code></a>: works with <code>ggplot</code> but not on CRAN</p></li>
<li><p><a href="https://jakob.schwalb-willmann.de/basemaps/"><code>basemaps</code></a>: many formats to download basemaps, but removed from CRAN and currently down’t work for me</p></li>
<li><p><a href="https://github.com/markusloecher/rgooglemaps"><code>rgooglemaps</code></a></p></li>
<li><p><a href="https://hypertidy.github.io/ceramic/"><code>ceramic</code></a></p></li>
<li><p><a href="https://michaeldorman.github.io/mapsapi/"><code>mapsapi</code></a></p></li>
<li><p><a href="https://mikkovihtakari.github.io/ggOceanMaps/"><code>ggOceanMaps</code></a>: designed for ocean sciences, visualizes with <code>ggplot2</code></p>
<ul>
<li>some additional ocean map packages: <code>marmap</code>, <code>oceanmap</code>, <code>oce</code></li>
</ul></li>
</ul>
</section>
<section id="retrieving-your-basemap" class="level2">
<h2 class="anchored" data-anchor-id="retrieving-your-basemap">Retrieving your basemap</h2>
<p>This usually requires you to set an extent or bounding box for your download, as well as specify the zoom level you want.</p>
<p>[Check - the zoom level can influence whether your output map looks grainy or not]</p>
<section id="using-ggspatial" class="level3">
<h3 class="anchored" data-anchor-id="using-ggspatial">Using <code>ggspatial</code></h3>
<p>What are the built-in basemap options?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>rosm<span class="sc">::</span><span class="fu">osm.types</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "osm"                    "opencycle"              "hotstyle"              
 [4] "loviniahike"            "loviniacycle"           "stamenbw"              
 [7] "stamenwatercolor"       "osmtransport"           "thunderforestlandscape"
[10] "thunderforestoutdoors"  "cartodark"              "cartolight"            </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>map_nobase <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># must specify "data = " or it will throw an error</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ecoreg_sf, <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME)) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>map_nobase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/ggspatial-basemap-1.png" class="img-fluid" width="768"></p>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>map_wbase <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"osm"</span>, <span class="at">zoom =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># must specify "data = " or it will throw an error</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ecoreg_sf, <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>map_wbase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching 9 missing tiles</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |================                                                      |  22%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |===============================                                       |  44%
  |                                                                            
  |=======================================                               |  56%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |======================================================                |  78%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>...complete!</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/ggspatial-basemap-2.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Compare the visual with and without the basemap. Aside from the basemap, can you notice any differences?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>map_nobase <span class="sc">+</span> map_wbase</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 6</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Yes, the projection is different! That is one of the annoying things about using ggspatial - it downloads the basemaps in a specific CRS - the Web Mercator projection (<code>EPSG:3857</code>). If it is the first layer added, then other layers are reprojected to Web Mercator, which is why the two maps look different.</p>
<p>If you want to have the map in the CRS of the data, specify a data argument in the call to <code>ggplot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ca_proj_sf) <span class="sc">+</span> <span class="co"># specify data here to set CRS </span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(<span class="at">type =</span> <span class="st">"osm"</span>, <span class="at">zoom =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> site_ecoreg_sf, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: raster</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching 3 missing tiles</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |=======================                                               |  33%
  |                                                                            
  |===============================================                       |  67%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>...complete!</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>Now the map is back in the projection of the data, which is helpful if you don’t want to be stuck with only one option for the CRS of your map.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are reprojecting basemap tiles that include text, you may note that the text is blurry or not as high-resolution.</p>
</div>
</div>
</section>
<section id="using-maptiles" class="level3">
<h3 class="anchored" data-anchor-id="using-maptiles">Using <code>maptiles</code></h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ca3857 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ca_proj_sf, <span class="st">"epsg:3857"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>ca_osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(ca3857, <span class="at">crop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ca3857) <span class="sc">+</span> </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> ca_osm, <span class="at">r =</span> <span class="dv">1</span>, <span class="at">g =</span> <span class="dv">2</span>, <span class="at">b =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">st_transform</span>(site_ecoreg_sf, <span class="at">crs =</span> <span class="st">"epsg:3857"</span>), </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME) </span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">#inherit.aes = FALSE # I've found I sometimes need to add this if I am having issues</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="additional-basemap-options" class="level3">
<h3 class="anchored" data-anchor-id="additional-basemap-options">Additional basemap options</h3>
<p>In addition to the built-in tile servers, you can also source a basemap from using a URL for an xyz raster source with ggspatial. Make sure you include attributions for the basemap service you use. The <a href="https://wiki.openstreetmap.org/wiki/Raster_tile_providers">OpenStreetMap wiki</a> page has a list of Tile providers and the urls for you to use to access them. Some of these servers require you to register, but many have a free tier for low volume users.</p>
<p>For this to work with <code>ggspatial</code>, you just put the URL in the “type” argument. You also need to make sure that the URL you use has a “$” in front of the {z}, {y}, and {x} otherwise the call returns an error. Additionally, make sure that there is an extension on the URL (.png, .jpg, or .jpeg) - this is also required for the function call to run properly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the OpenTopo map tile provider</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>open_topo <span class="ot">&lt;-</span> <span class="st">"https://a.tile.opentopomap.org/${z}/${x}/${y}.png"</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ca_proj_sf) <span class="sc">+</span> <span class="co"># specify data here to set CRS </span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_map_tile</span>(</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> open_topo,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">zoom =</span> <span class="dv">7</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="co"># don't need to specify data here since we did in ggplot call</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> site_ecoreg_sf, </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME) </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Zoom: 7</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Fetching 35 missing tiles</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |==                                                                    |   3%
  |                                                                            
  |====                                                                  |   6%
  |                                                                            
  |======                                                                |   9%
  |                                                                            
  |========                                                              |  11%
  |                                                                            
  |==========                                                            |  14%
  |                                                                            
  |============                                                          |  17%
  |                                                                            
  |==============                                                        |  20%
  |                                                                            
  |================                                                      |  23%
  |                                                                            
  |==================                                                    |  26%
  |                                                                            
  |====================                                                  |  29%
  |                                                                            
  |======================                                                |  31%
  |                                                                            
  |========================                                              |  34%
  |                                                                            
  |==========================                                            |  37%
  |                                                                            
  |============================                                          |  40%
  |                                                                            
  |==============================                                        |  43%
  |                                                                            
  |================================                                      |  46%
  |                                                                            
  |==================================                                    |  49%
  |                                                                            
  |====================================                                  |  51%
  |                                                                            
  |======================================                                |  54%
  |                                                                            
  |========================================                              |  57%
  |                                                                            
  |==========================================                            |  60%
  |                                                                            
  |============================================                          |  63%
  |                                                                            
  |==============================================                        |  66%
  |                                                                            
  |================================================                      |  69%
  |                                                                            
  |==================================================                    |  71%
  |                                                                            
  |====================================================                  |  74%
  |                                                                            
  |======================================================                |  77%
  |                                                                            
  |========================================================              |  80%
  |                                                                            
  |==========================================================            |  83%
  |                                                                            
  |============================================================          |  86%
  |                                                                            
  |==============================================================        |  89%
  |                                                                            
  |================================================================      |  91%
  |                                                                            
  |==================================================================    |  94%
  |                                                                            
  |====================================================================  |  97%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>...complete!</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p><strong>Places to Retrieve Basemaps</strong></p>
<ul>
<li><p><a href="https://documentation.maptiler.com/hc/en-us">maptiler</a>: XYZ rasters, free tier, requires API</p></li>
<li><p><a href="https://xyzservices.readthedocs.io/en/stable/introduction.html">xyzservices</a>: list of xyz sources, some free some require subscriptions</p></li>
<li><p><a href="https://wiki.openstreetmap.org/wiki/Raster_tile_providers">OpenStreetMap wiki</a></p></li>
<li><p>https://www.xyht.com/spatial-itgis/using-openstreetmap-basemaps-qgis-3-0/</p></li>
<li><p>https://github.com/roblabs/xyz-raster-sources</p></li>
</ul>
</section>
<section id="basemap-from-file" class="level3">
<h3 class="anchored" data-anchor-id="basemap-from-file">Basemap from File</h3>
<p>You can also add a basemap from a file in a similar way to the <code>maptiles</code> code, if your basemap layer is a GeoTiff file (.tif). Simply read in your data layer with <code>terra</code> and add it to your plot with <code>tidyterra::geom_spatraster_rgb()</code> or <code>tidyterra::geom_spatraster()</code> if it is a single layer.</p>
<p>Example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This code not run, shown as a demo</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load aerial imagery from National Agricultural Imagery Program</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>naip_tif <span class="ot">&lt;-</span> <span class="fu">rast</span>(<span class="st">"data/naip_imagery.tif"</span>) </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>samp_pts_sf <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/shapefiles/sample_points.shp"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> samp_pts_sf) <span class="sc">+</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> naip_tif) <span class="sc">+</span> </span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="add-a-scalebar-and-north-arrow" class="level2">
<h2 class="anchored" data-anchor-id="add-a-scalebar-and-north-arrow">Add a scalebar and north arrow</h2>
<p>It is usually helpful to have a scalebar and north arrow for reference and orientation. There are built-in functions in <code>ggspatial</code> to make this easy:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ca_osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(ca_proj_sf, <span class="at">crop =</span> <span class="cn">TRUE</span>, <span class="at">zoom =</span> <span class="dv">6</span>, <span class="at">provider =</span> <span class="st">"Esri.WorldImagery"</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ca_proj_sf) <span class="sc">+</span> <span class="co"># specify data here to set CRS </span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> ca_osm) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="co"># don't need to specify data here since we did in ggplot call</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> site_ecoreg_sf, </span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME) </span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">#inherit.aes = FALSE # I've found I sometimes need to add this if I am having issues</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># theme(</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   legend.position = "bottom",</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   legend.direction = "vertical"</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ) +</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>() <span class="sc">+</span></span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<section id="manipulating-scale-and-north-arrow" class="level3">
<h3 class="anchored" data-anchor-id="manipulating-scale-and-north-arrow">Manipulating scale and north arrow</h3>
<p>You’ll notice that with the basic options, the scale bar and north arrow overlap, and the scale or arrow may not display at an appropriate size with the default options. Some helpful arguments for manipulating the appearance of the scale bar and north arrows are shown below.</p>
<p><strong>Arguments for both <code>annotation_scale</code> and <code>annotation_north_arrow</code></strong></p>
<ul>
<li><p><code>pad_y</code> and <code>pad_x</code>: change the positioning of the arrows from the corner</p></li>
<li><p><code>height</code> and <code>width</code>: change the size of the arrow</p></li>
</ul>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>You must use the <code>unit([value], "unit")</code> function to specify position and size options for the padding, height, and width options or the call will return an error message. For example:</p>
<pre><code>annotation_scale(pad_x = unit(0.5, "cm"))</code></pre>
</div>
</div>
<ul>
<li><p><code>style</code>:</p>
<ul>
<li><p>for north arrow, specify style with a call to one of the built-in arrow functions, e.g. <code>north_arrow_fancy_orienteering</code>. This also allows you to change line and text color of the arrow.</p></li>
<li><p>for scale bar, one of “bar” or “ticks”</p></li>
</ul></li>
<li><p><code>location</code>: general location to put the scalebar or north arrow, e.g.&nbsp;“tl” for “top left”</p></li>
</ul>
<p><strong>North arrow only</strong></p>
<ul>
<li><code>which_north</code>: “grid” - north arrow points up; “true” - north arrow points to north pole (may need to modify depending on projection)</li>
</ul>
<p><strong>Scale bar only</strong></p>
<ul>
<li><p><code>width_hint</code>: roundabout way of controlling how wide the scale_bar is, which is the only way to change the number of breaks displayed</p></li>
<li><p><code>unit_category</code>: “metric” or “imperial” units</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ca_proj_sf) <span class="sc">+</span> <span class="co"># specify data here to set CRS </span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> ca_osm) <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> site_ecoreg_sf, </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> US_L3NAME) </span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_discrete</span>(<span class="at">name =</span> <span class="st">"Level 3 Ecoregion"</span>) <span class="sc">+</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.direction =</span> <span class="st">"vertical"</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>), </span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">width_hint =</span> <span class="fl">0.3</span>,</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">unit_category =</span> <span class="st">"imperial"</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>(</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">"cm"</span>),</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="fu">unit</span>(<span class="fl">0.75</span>, <span class="st">"cm"</span>),</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> ggspatial<span class="sc">::</span><span class="fu">north_arrow_fancy_orienteering</span>(</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">line_col =</span> <span class="st">"grey20"</span>,</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"grey20"</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<ol class="example" type="1">
<li>Use the <code>tigris</code> package and either <code>ggspatial</code> or <code>maptiles</code> package to download a basemap for a different state and then visualize it with <code>ggplot</code></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Template code</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" class="example" type="1">
<li>Too easy? Try downloading either another data type from the <code>tigris</code> package (e.g., roads or county lines) or another data repository of your choice and plotting that on top of your basemap.</li>
</ol>
</section>
</section>
<section id="part-iii-tips-and-tricks" class="level1">
<h1>Part III: Tips and Tricks</h1>
<section id="making-an-inset-map" class="level2">
<h2 class="anchored" data-anchor-id="making-an-inset-map">Making an inset map</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select central california dryland ecoregions</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>ecoreg_sjv <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"6ac"</span>, <span class="st">"6an"</span>, <span class="st">"6ak"</span>, <span class="st">"6ao"</span>, <span class="st">"6am"</span>, <span class="st">"6ad"</span>) </span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>ecoreg_pan <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"6aa"</span>, <span class="st">"6ab"</span>, <span class="st">"7v"</span>, <span class="st">"7u"</span>, <span class="st">"6al"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>ecoreg_CV <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"7o"</span>, <span class="st">"7m"</span>, <span class="st">"7r"</span>, <span class="st">"7t"</span>, <span class="st">"7s"</span>,<span class="st">"7q"</span>, <span class="st">"7d"</span>, <span class="st">"7p"</span>, <span class="st">"7n"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataframe for grouping</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>all_groups <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> <span class="fu">c</span>(</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"SJV"</span>, <span class="fu">length</span>(ecoreg_sjv)),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"PAN"</span>, <span class="fu">length</span>(ecoreg_pan)),</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rep</span>(<span class="st">"CV"</span>, <span class="fu">length</span>(ecoreg_CV))</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">l4_code =</span> <span class="fu">c</span>(ecoreg_sjv, ecoreg_pan, ecoreg_CV)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># filter ecoregion shapefile to just the l4 codes specified fro the central drylands</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>all_eco <span class="ot">&lt;-</span> ecoreg_sf <span class="sc">%&gt;%</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(all_groups, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"US_L4CODE"</span> <span class="ot">=</span> <span class="st">"l4_code"</span>))</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the inner boundaries of the L4 with st_union to create a shapefile with </span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="co"># only L3 boundaries </span></span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>all_eco <span class="ot">&lt;-</span> all_eco <span class="sc">%&gt;%</span> </span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">geometry =</span> <span class="fu">st_union</span>(geometry)) </span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a><span class="co"># transform to proper CRS for plotting</span></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>dryland_eco_3857 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(all_eco, <span class="at">crs =</span> <span class="st">"epsg:3857"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot) <span class="co"># for combining maps</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform outline to get tiles</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>ca3857 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ca_proj_sf, <span class="st">"epsg:3857"</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>ca_osm <span class="ot">&lt;-</span> <span class="fu">get_tiles</span>(</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(dryland_eco_3857, <span class="dv">50000</span>), </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">crop =</span> <span class="cn">TRUE</span>, </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">zoom =</span> <span class="dv">7</span>, </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">provider =</span> <span class="st">"Esri.WorldImagery"</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot boundary with a buffer</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># this creates a buffer of 50 km (50000 m, the CRS units)</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plot_bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(<span class="fu">st_buffer</span>(dryland_eco_3857, <span class="dv">50000</span>))</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co"># join the boundaries to remove the L3 ecoregion layers</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>dryland_eco_join_3857 <span class="ot">&lt;-</span> <span class="fu">st_union</span>(dryland_eco_3857)</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="co"># make inset map</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>inset_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dryland_eco_3857, <span class="at">fill =</span> <span class="st">"grey80"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca3857, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text        =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks       =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border     =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.background  =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"white"</span>))</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># make main map </span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>main_map <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a>  tidyterra<span class="sc">::</span><span class="fu">geom_spatraster_rgb</span>(<span class="at">data =</span> ca_osm) <span class="sc">+</span> </span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dryland_eco_join_3857, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span> </span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca3857, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span> </span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> plot_bbox[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)],</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> plot_bbox[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)],</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_col =</span> <span class="st">"white"</span>, </span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">line_col =</span> <span class="st">"black"</span>, </span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y    =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>(</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>), </span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span>  ggspatial<span class="sc">::</span><span class="fu">north_arrow_fancy_orienteering</span>(<span class="at">text_col =</span> <span class="st">'white'</span>, <span class="at">line_col =</span> <span class="st">"white"</span>)) </span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="co"># combine into one plot</span></span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdraw</span>() <span class="sc">+</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(main_map) <span class="sc">+</span></span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_plot</span>(inset_map,</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">height =</span> <span class="fl">0.28</span>,</span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fl">0.16</span>,</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="fl">0.68</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Map of central California drylands including the San Joaquin Desert. Basemap imagery from ESRI</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="creating-a-theme-and-setting-defaults" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-theme-and-setting-defaults">Creating a Theme and Setting Defaults</h2>
<section id="create-your-own-theme" class="level3">
<h3 class="anchored" data-anchor-id="create-your-own-theme">Create your own theme</h3>
<p>Specifying the theme parameters each time takes up a lot of code, so I like to find base theme, modify it, and then save it as a new theme so I can add it to the map with one line of code. This also makes it easier to modify multiple plots since you will only have to change the code in one place to modify your theme as opposed to all of your code to make each map.</p>
<p>For mapping, I like to start with either <code>theme_bw()</code> if you want lat/long included or <code>theme_void()</code> if you don’t want any of the normal plot features.</p>
<p>There are a large number of different elements you can control with themes (see https://ggplot2-book.org/themes for an overview), but to manipulate the plot appearance you will usually follow this general template:</p>
<pre><code>plot + theme(element.name = element_function(argument = "option"))</code></pre>
<p>Most theme elements are also hierarchical, so they inherit from the parent element. This means that if you want to change all of the font for your plot, you only need to change the <code>text</code> element. Or, you could just change the <code>axis.text</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>theme_bw_ag <span class="ot">&lt;-</span> <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">text             =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"AvantGarde"</span>),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="co"># use element_blank() to remove elements</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border     =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey92"</span>),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks       =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey92"</span>),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text        =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x      =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also specify default color and fill options by creating a layer with the <code>theme</code> and <code>scale_*_manual</code> options as shown below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fill colors</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>ecoreg_fill <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#fed725"</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#cde11d"</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#98d83e"</span>,</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#67cc5c"</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#40bd72"</span>,</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#25ac82"</span>,</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#1f998e"</span>,</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#24878e"</span>,</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#2b748e"</span>,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#34618d"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#3d4d8a"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#453581"</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#481c6e"</span>,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#440154"</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>ecoreg_theme <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">14</span>),</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ecoreg_fill, <span class="at">name =</span> <span class="st">"US L3 Ecoregion"</span>),</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">text             =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"AvantGarde"</span>),</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="co"># use element_blank() to remove elements</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.background  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.border     =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">"grey92"</span>),</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks       =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"grey92"</span>),</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text        =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">"grey40"</span>),</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x      =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">35</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">vjust =</span> <span class="dv">1</span>)</span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For better font support and options see the <a href="https://github.com/wch/extrafont/tree/master"><strong><code>extrafont</code></strong></a> package</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># must specify "data = " or it will throw an error</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ecoreg_sf, <span class="fu">aes</span>(<span class="at">fill =</span> US_L3NAME), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> <span class="co"># like other data you can set fill </span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ca_proj_sf) <span class="sc">+</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  ecoreg_theme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="set-geometry-defaults" class="level3">
<h3 class="anchored" data-anchor-id="set-geometry-defaults">Set Geometry Defaults</h3>
<p>You are also able to set some defaults for parameters that you can’t easily modify with <code>ggplot</code> themes. For example, specifying shapes and sizes for points or linewidth and colors for polygons.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set defaults for point geometry</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">update_geom_defaults</span>(</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"point"</span>, <span class="fu">list</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"grey20"</span>, <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="co"># don't specify data here since we have multiple data sets to plot</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ecoreg_sf, <span class="fu">aes</span>(<span class="at">fill =</span> stringr<span class="sc">::</span><span class="fu">str_wrap</span>(US_L3NAME, <span class="dv">35</span>)), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> site_ca_proj_sf, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> ca_proj_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"grey40"</span>) <span class="sc">+</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">title.position =</span> <span class="st">"top"</span>)) <span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  ecoreg_theme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sf_basemap_workshop_ecodatasci_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="functional-programming" class="level2">
<h2 class="anchored" data-anchor-id="functional-programming">Functional Programming</h2>
<p>What if you want to make a lot of maps? Copying and pasting code is annoying and also leads to issues with reproducibility. If you are going to be making multiple maps that are very similar you can turn your call to <code>ggplot</code> into a function so that all you need to do is provide the data or other parameters you want to manipulate and save yourself many lines of code. This will also allow you to more easily modify multiple plots by only having to change your code in one place.</p>
<p>As an example, let’s play around with the California ecoregions some more.</p>
</section>
</section>
<section id="additional-resources" class="level1">
<h1>Additional Resources</h1>
<p><strong>Other Data Providers</strong></p>
<ul>
<li><p><a href="https://www.naturalearthdata.com/features/">Natural Earth</a></p></li>
<li><p><a href="https://www.paulamoraga.com/book-spatial/r-packages-to-download-open-spatial-data.html">List of Data sites</a></p></li>
</ul>
<p><strong>other packages</strong></p>
<ul>
<li><p><a href="https://docs.ropensci.org/osmplotr/index.html#3%20simple%20map"><code>osmplotr</code></a>: custom images from OSM data</p></li>
<li><p><a href="https://r-spatial.github.io/mapview/index.html"><code>mapview</code></a>: interactive plotting in r</p></li>
<li><p><a href="https://rstudio.github.io/leaflet/"><code>leaflet</code></a>: interactive plotting, can use with mapview to create a static map supposedly but best for interactive maps</p></li>
<li><p><a href="https://www.rayshader.com/"><code>rayshader</code></a>: make 3D plots in R</p></li>
</ul>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ol type="1">
<li><a href="https://r.geocompx.org/">Geocomputation with R</a>: Free ebook with lots of great information and code demos about working with spatial data in R</li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/main/sf.pdf"><code>sf</code> Cheatsheet</a></li>
<li><a href="https://ajsmit.github.io/Intro_R_Official/mapping-google.html"><code>OpenStreetMap</code> example</a></li>
</ol>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>